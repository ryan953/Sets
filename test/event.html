<!DOCTYPE html>
<html>
<head>
<title>Test: event.js</title>
<link rel="stylesheet" href="../lib/qunit.css" type="text/css" media="screen" />
<script src="../lib/qunit.js"></script>
<script src="../lib/jquery-1.7.2.min.js"></script>

<script src="../lib/event.js"></script>

<script>
"use strict";

$(document).ready(function () {
	module('Event');
	test('Create and fire an event', function() {
		stop();
		var evt = new Event(),
			obj = {
				test:function(e, data) {
					equal(eventData, data, 'event fired and arguments are ok');
					start();
				},
				name: 'hello'
			},
			name = 'sample-event',
			action = obj.test,
			binding = obj,
			eventData = {v1:'abc', v2:'123'};

		evt.addListener(obj, name, action/*, binding*/);
		evt.fireEvent({}, obj, name, eventData);
	});

	test('Can unbind an event', function() {
		var evt = new Event(),
		obj = { test:function(e, data) {} },
		name = 'sample-event',
		action = obj.test,
		binding = obj;

		evt.addListener(obj, name, action/*, binding*/);
		evt.removeListener(obj, name, action/*, binding*/);
		ok(true, 'event should be unbound');
	});

	test('patch() adds the required functions', function() {
		var obj = {};
		Event.patch.call(obj);
		ok(obj.event);
		ok(obj.bind);
		ok(obj.trigger);
		ok(obj.unbind);
	});

	test('patch() delegates events correctly', function() {
		stop(3);
		var obj = {};
		Event.patch.call(obj);

		var expected = {
			name: 'sample-event',
			handler: function() { return true; },
			data: {'hello':'world'}
		};

		obj.event.addListener = function(what, name, handler) {
			equal(what, obj);
			equal(name, expected.name);
			start();
		};
		obj.event.fireEvent = function(e, what, name, data) {
			equal(what, obj);
			equal(name, expected.name);
			equal(data, expected.data);
			start();
		};
		obj.event.removeListener = function(what, name, handler) {
			equal(what, obj);
			equal(name, expected.name);
			equal(handler, expected.handler);
			start();
		};

		obj.bind(expected.name, expected.handler);
		obj.trigger(expected.name, expected.data);
		obj.unbind(expected.name, expected.handler);
	});
});
</script>

</head>
<body>
	<div id="qunit"></div>
	<div id="qunit-fixture">test markup, will be hidden</div>
</body>
</html>
