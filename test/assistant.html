<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<link rel="stylesheet" href="../lib/qunit.css" type="text/css" media="screen" />
<script src="../lib/qunit.js"></script>
<script src="../lib/jquery-1.6.4.js"></script>

<script src="../js/event.js"></script>
<script src="../js/logic.js"></script>
<script src="../js/assistant_worker.js"></script>

<script>
$(document).ready(function () {
	function getSimpleBoard() {
		return [
			new Card( 1, "Oval", "striped", "green"),
			new Card( 1, "Oval", "striped", "red"),
			new Card( 1, "Oval", "striped", "blue")
		];
	}
	
	
	module('Assistant Worker::Clock');
	test('clock ticks', function() {
		var count = 2, delay = 500;
		stop(count);
		AssistantWorker.startClock(delay, function() {
			ok(true, 'Clock tick ' + count);
			start();
			count--;
			return (count > 0);
		});
	});
	
	
	module('pickNotSelectedCard()');
	
	test('Pick from empty list', function() {
		var board = [];
		
		var card = AssistantWorker.pickNotSelectedCard(board);
		equals(card, null, 'should not pick from an empty list of cards');
	});
	
	test('Pick from normal list', function() {
		var board = getSimpleBoard();
		
		board[0].deselect();
		board[1].select();
		board[2].select();
		var card = AssistantWorker.pickNotSelectedCard(board);
		deepEqual(card, board[0], 'only one card in this list is not already selected');
		
		board[0].select();
		board[1].deselect();
		board[2].select();
		var card = AssistantWorker.pickNotSelectedCard(board);
		deepEqual(card, board[1], 'only one card in this list is not already selected');
		
		board[0].select();
		board[1].select();
		board[2].deselect();
		var card = AssistantWorker.pickNotSelectedCard(board);
		deepEqual(card, board[2], 'only one card in this list is not already selected');
	});
	
	test('Pick from selected list', function() {
		var board = getSimpleBoard();
		board[0].select();
		board[1].select();
		board[2].select();
		
		var card = AssistantWorker.pickNotSelectedCard(board);
		equals(card, null, 'should not be able to pick anything from a list with everything selected');
	});
	
	
	module('findNotPossibleCard');
	
	test('find a card that is not a set (board3), given two selected', function() {
		var board = getSimpleBoard();
		board[0].select();
		board[1].select();
		
		board[2].shape = 'diamond'; // will not make a set with the other two
		
		var card_no_set = AssistantWorker.findNotPossibleCard(board);
		equals(card_no_set, board[2]);
	});
	
	test('find a card that is not a set (board4), given two selected', function() {
		var board = getSimpleBoard();
		board[0].select();
		board[1].select();
		//board 2 will make a set
		board.push(new Card(2, "Oval", "striped", "green")); //add 4th card, will not make a set with existing
		
		var expected = board[3];
		
		var card_no_set = AssistantWorker.findNotPossibleCard(board);
		equals(card_no_set, expected);
	});
	
	test('find a card that is not a set (board3), given one selected', function() {
		var board = getSimpleBoard();
		board[0].select();
		//board 0,1,2 will make a set
		board.push(new Card(2, "Oval", "striped", "green")); //add 4th card, will not make a set with existing
		
		var expected = new Card(
			board[3].count,
			board[3].shape,
			board[3].fill,
			board[3].color
		);
		expected.isSelected = false;
		expected.notPossible = true;
		
		var card_no_set = AssistantWorker.findNotPossibleCard(board);
		console.debug('board', board);
		//console.debug('card_no_set', card_no_set, 'expected', expected);
		deepEqual(card_no_set, expected);
	});
});
</script>

</head>
<body>
	<h1 id="qunit-header">Sets! Card Game Tests</h1>
	<h2 id="qunit-banner"></h2>
	<h2 id="qunit-userAgent"></h2>
	<div id="qunit-testrunner-toolbar"></div>
	<ol id="qunit-tests"></ol>
	<div id="qunit-fixture">test markup, will be hidden</div>
</body>
</html>
